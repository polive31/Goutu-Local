var currentRowId,previousRowId,xhr_ingredient=[];function isValid(id){var isValid=!0,thisIngredient,inputField;return null==getIngredientbyId(id).find(".name input").val()&&(isValid=!1),console.log("Is Valid = "+isValid),isValid}function getIngredientbyId(id){return jQuery("#recipe-ingredients").find("#"+id)}function displayIngredientPreview(thisIngredientId){console.log("%c Display Ingredient Preview on "+thisIngredientId,"background: #ccc; color: blue");var thisIngredient=getIngredientbyId(thisIngredientId);try{xhr_ingredient[thisIngredientId].abort(),console.log("%c Aborting previous ajax call for "+thisIngredientId,"background: #ccc; color: blue")}catch(e){console.log("%c No previous ajax call for "+thisIngredientId,"background: #ccc; color: blue")}console.log("%c Ajax call launched","background: #ccc; color: blue"),console.log("Ajaxurl",ingredient_preview.ajaxurl),xhr_ingredient[thisIngredientId]=jQuery.ajax({url:ingredient_preview.ajaxurl,method:"POST",data:{action:"ingredient_preview",security:ingredient_preview.nonce,amount:thisIngredient.find(".ingredients_amount").val(),unit:thisIngredient.find(".ingredients_unit").val(),ingredient:thisIngredient.find(".ingredients_name").val(),notes:thisIngredient.find(".ingredients_notes").val()},success:function(response){if(response.success){console.log("Ajax ingredient preview success for "+thisIngredientId),console.log("Ingredient is "+thisIngredient);var target=thisIngredient.find("td.ingredient-preview");jQuery("#recipe-ingredients").on("focusin","tr.ingredient",!1),jQuery("#recipe-ingredients").on("blur","tr.ingredient",!1),target.html(response.data.msg),thisIngredient.removeClass("edit new"),thisIngredient.addClass("saved"),jQuery("#recipe-ingredients").off("focusin","tr.ingredient",!1),jQuery("#recipe-ingredients").off("blur","tr.ingredient",!1)}else console.log("Error on Ajax call processing : "+response.data.msg)},error:function(response){console.log("Ajax call failed : "+response.msg)}})}jQuery(document).ready(function(){jQuery("#recipe-ingredients").on("focusin","tr.ingredient",function(){currentRowId=jQuery(this).attr("id"),jQuery(this).removeClass("saved new"),jQuery(this).addClass("edit")}),jQuery("#recipe-ingredients").on("blur","tr.ingredient",function(){var rowId;currentRowId=-1,previousRowId=jQuery(this).attr("id"),setTimeout(function(){console.log("after timeout variables are : ",previousRowId,currentRowId),previousRowId!=currentRowId&&isValid(previousRowId)&&displayIngredientPreview(previousRowId)},100)}),jQuery(document).on("click","tr.saved",function(){console.log("%c Click on tr.ingredient.saved"+jQuery(this).attr("id"),"background:#D7EEC0;color:green"),jQuery(this).focus()})});