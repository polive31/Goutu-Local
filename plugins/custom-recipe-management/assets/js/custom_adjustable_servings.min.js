var wpurp_adjustable_servings={};jQuery(document).ready((function(){jQuery("tooltip").oncontextmenu=function(event){return event.preventDefault(),event.stopPropagation(),!1},jQuery(document).on("click","#servings .qty",(function(){var $button=jQuery(this),$input=$button.parent().find("input"),oldValue=$input.val();if("inc"==$button.attr("id"))var newVal=parseFloat(oldValue)+1;else if(oldValue>1)var newVal=parseFloat(oldValue)-1;else newVal=1;$input.val(newVal),$input.trigger("change")})),jQuery(document).on("keyup change",".adjust-recipe-servings",(function(e){var servings_input=jQuery(this);console.log("In adjust recipe servings keyup change");var amounts=servings_input.parents(".ingredients-container").find(".recipe-ingredient-quantity"),servings_original=parseFloat(servings_input.data("original")),servings_new=servings_input.val();(isNaN(servings_new)||servings_new<=0)&&(servings_new=1),wpurp_adjustable_servings.updateAmounts(amounts,servings_original,servings_new),wpurp_adjustable_servings.updateShortcode(servings_input.parents(".wpurp-container"),servings_new),RecipePrintButton.update(servings_input.parents(".wpurp-container"))})),jQuery(document).on("blur",".adjust-recipe-servings",(function(e){var servings_input=jQuery(this),servings_new=servings_input.val();(isNaN(servings_new)||servings_new<=0)&&(servings_new=1),servings_input.parents(".wpurp-container").find(".adjust-recipe-servings").each((function(){jQuery(this).val(servings_new)})),RecipePrintButton.update(servings_input.parents(".wpurp-container"))}))})),wpurp_adjustable_servings.updateShortcode=function(recipe,servings_new){var servings_original=parseFloat(recipe.data("servings-original"));recipe.find(".wpurp-adjustable-quantity").each((function(){var quantity_element=jQuery(this);if(void 0===quantity_element.data("original_quantity")){var quantity=wpurp_adjustable_servings.parse_quantity(quantity_element.text());quantity/=servings_original,quantity_element.data("original_quantity",quantity_element.text()).data("unit_quantity",quantity)}if(servings_new==servings_original)quantity_element.text(quantity_element.data("original_quantity"));else{var quantity=parseFloat(quantity_element.data("unit_quantity"))*servings_new;isNaN(quantity)||quantity_element.text(wpurp_adjustable_servings.toFixed(quantity,!1))}}))},wpurp_adjustable_servings.parse_quantity=function(sQuantity){sQuantity=sQuantity.replace(",",".");var fractionsRegex,fractionsMap={"¼":" 1/4","½":" 1/2","¾":" 3/4","⅐":" 1/7","⅑":" 1/9","⅒":" 1/10","⅓":" 1/3","⅔":" 2/3","⅕":" 1/5","⅖":" 2/5","⅗":" 3/5","⅘":" 4/5","⅙":" 1/6","⅚":" 5/6","⅛":" 1/8","⅜":" 3/8","⅝":" 5/8","⅞":" 7/8"},parts=(sQuantity=(sQuantity=(sQuantity+"").replace(/(\u00BC|\u00BD|\u00BE|\u2150|\u2151|\u2152|\u2153|\u2154|\u2155|\u2156|\u2157|\u2158|\u2159|\u215A|\u215B|\u215C|\u215D|\u215E)/,(function(m,vf){return fractionsMap[vf]}))).trim()).split(" "),quantity=!1;if(""!==sQuantity){quantity=0;for(var i=0;i<parts.length;i++)if(""!==parts[i].trim()){var division_parts=parts[i].split("/",2),part_quantity=parseFloat(division_parts[0]);if(void 0!==division_parts[1]){var divisor=parseFloat(division_parts[1]);0!==divisor&&(part_quantity/=divisor)}quantity+=part_quantity}}return quantity},wpurp_adjustable_servings.updateAmounts=function(amounts,servings_original,servings_new){console.log("In updateAmounts"),amounts.each((function(){var amount=parseFloat(jQuery(this).data("normalized")),fraction=jQuery(this).data("fraction");if(servings_original==servings_new)jQuery(this).text(jQuery(this).data("original"));else if(isFinite(amount)){var new_amount=servings_new*amount/servings_original,new_amount_text=wpurp_adjustable_servings.toFixed(new_amount,fraction);jQuery(this).text(new_amount_text+" "),ingredientUnit=jQuery(this).next().html(),ingredientUnit.length||(ingredientNameContainer=jQuery(this).parents(".wpurp-recipe-ingredient").find(".recipe-ingredient-name"),ingredientNameRoot=jQuery(this).parents(".wpurp-recipe-ingredient").find("#ingredient_name_root"),new_amount>=2?ingredientNameContainer.data("plural").length&&ingredientNameRoot.html(ingredientNameContainer.data("plural")):ingredientNameContainer.data("singular").length&&ingredientNameRoot.html(ingredientNameContainer.data("singular")))}else jQuery(this).addClass("recipe-ingredient-nan")}))},wpurp_adjustable_servings.toFixed=function(amount,fraction){if(fraction){var fractioned_amount=Fraction(amount.toString()).snap();if(fractioned_amount.denominator<100)return fractioned_amount}if(""==amount||0==amount)return"";for(var precision=parseInt(wpurp_servings.precision),formatted=amount.toFixed(precision);0==parseFloat(formatted);)if(precision++,formatted=amount.toFixed(precision),precision>10)return"";if(precision>0){var zeroes=Array(precision+1).join("0");formatted=formatted.replace(new RegExp("."+zeroes+"$"),"")}return"undefined"!=typeof wpurp_servings&&(formatted=formatted.replace(".",wpurp_servings.decimal_character)),formatted};