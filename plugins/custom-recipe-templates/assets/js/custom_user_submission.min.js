function isLastIngredient(e){console.log("%c In isLastIngredient","background:#CCC;color:red;padding:10px;border-radius:2px"),console.log("item = "+e.attr("id"));var t=e.next(".ingredient-group").length;console.log("next group = "+e.next(".ingredient-group").prop("tagName")),console.log("has group after = "+t),console.log("#recipe-ingredients tr:last");var i=e.attr("id")==jQuery("#recipe-ingredients tr:last").attr("id");return console.log("is last ingredient = "+i),t||i}function PreviewImage(e){var t=new FileReader;t.readAsDataURL(document.getElementById("recipe_thumbnail_input_"+e).files[0]),t.onload=function(t){document.getElementById("instruction_thumbnail_preview_"+e).src=t.target.result}}function addRecipeIngredientGroup(){var e=jQuery("#recipe-ingredients tr.ingredient-group-stub"),t=jQuery("#recipe-ingredients tr:last");e.clone(!0).insertAfter(t).removeClass("ingredient-group-stub").addClass("ingredient-group"),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show(),calculateIngredientGroups()}function calculateIngredientGroups(){1==jQuery(".ingredient-group").length?(jQuery("#recipe-ingredients .ingredient .ingredients_group").val(""),jQuery(".ingredient-groups-disabled").show(),jQuery(".ingredient-groups-enabled").hide()):(jQuery("#recipe-ingredients tr.ingredient").each(function(e,t){var i=jQuery(t).prevAll(".ingredient-group:first").find(".ingredient-group-label").val();void 0===i&&(i=jQuery(".ingredient-group-first").find(".ingredient-group-label").val()),jQuery(t).find(".ingredients_group").val(i)}),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show())}function addRecipeInstructionGroup(){var e=jQuery("#recipe-instructions tr.instruction-group-stub"),t=jQuery("#recipe-instructions tr:last");e.clone(!0).insertAfter(t).removeClass("instruction-group-stub").addClass("instruction-group"),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show(),calculateInstructionGroups()}function calculateInstructionGroups(){1==jQuery(".instruction-group").length?(jQuery("#recipe-instructions .instruction .instructions_group").val(""),jQuery(".instruction-groups-disabled").show(),jQuery(".instruction-groups-enabled").hide()):(jQuery("#recipe-instructions tr.instruction").each(function(e,t){var i=jQuery(t).prevAll(".instruction-group:first").find(".instruction-group-label").val();void 0===i&&(i=jQuery(".instruction-group-first").find(".instruction-group-label").val()),jQuery(t).find(".instructions_group").val(i)}),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show())}function updateIngredientIndex(){jQuery("#recipe-ingredients tr.ingredient").each(function(e){jQuery(this).find("input, textarea").attr("name",function(t,i){return i.replace(/(\d+)/,e)}).attr("id",function(t,i){return i.replace(/(\d+)/,e)})})}function addRecipeIngredient(e){var t=jQuery("#recipe-ingredients tr.ingredient").length,i=jQuery("#recipe-ingredients tr:last");e&&(i=e);var n=i.clone(!0);n.find("td.ingredient-preview").html(""),n.insertAfter(i).find("input, select, textarea").val("").attr("name",function(e,i){return i.replace(/(\d+)/,t)}).attr("id",function(e,i){return i.replace(/(\d+)/,t)}).closest("tr.ingredient").attr("id",function(e,i){return i.replace(/(\d+)/,t)}),n.find("span.ingredients-delete").show(),jQuery("#recipe-ingredients tr:last .ingredients_amount").focus(),calculateIngredientGroups()}function addRecipeInstruction(){var e=jQuery("#recipe-instructions tr.instruction").length,t=jQuery("#recipe-instructions tr.instruction:last").clone(!0);t.insertAfter("#recipe-instructions tr:last").find("textarea").val("").attr("name",function(t,i){return i.replace(/(\d+)/,e)}).attr("id",function(t,i){return i.replace(/(\d+)/,e)}),t.find(".recipe_instructions_remove_image").addClass("wpurp-hide"),t.find(".recipe_instructions_add_image").removeClass("wpurp-hide"),t.find(".recipe_instructions_thumbnail").val(""),t.find(".recipe_instructions_image").attr("name",function(t,i){return i.replace(/(\d+)/,e)}).attr("id",function(t,i){return i.replace(/(\d+)/,e)}).val(null),t.find(".recipe_instructions_thumbnail").attr("id",function(t,i){return i.replace(/(\d+)/,e)}).attr("src",custom_user_submissions.placeholder),t.find(".instructions_group").attr("name",function(t,i){return i.replace(/(\d+)/,e)}).attr("id",function(t,i){return i.replace(/(\d+)/,e)}),t.find("span.instructions-delete").show(),jQuery("#recipe-instructions tr:last textarea").focus(),calculateInstructionGroups()}function updateInstructionIndex(){jQuery("#recipe-instructions tr.instruction").each(function(e){jQuery(this).find("textarea").attr("name",function(t,i){return i.replace(/(\d+)/,e)}).attr("id",function(t,i){return i.replace(/(\d+)/,e)}),jQuery(this).find(".recipe_instructions_image").attr("name",function(t,i){return i.replace(/(\d+)/,e)}),jQuery(this).find(".instructions_group").attr("name",function(t,i){return i.replace(/(\d+)/,e)}).attr("id",function(t,i){return i.replace(/(\d+)/,e)})})}jQuery(document).ready(function(){jQuery("#insert-recipe-shortcode").on("click",function(){n("[recipe]")}),jQuery("#insert-nutrition-shortcode").on("click",function(){n("[nutrition-label]")});var e,t,i=jQuery("textarea#content");function n(e){if(!tinyMCE.activeEditor||tinyMCE.activeEditor.isHidden()){var t=i.val();i.val(t+e)}else tinyMCE.execCommand("mceInsertContent",!1,e)}jQuery("#recipe-ingredients tr.ingredient:first").find("span.ingredients-delete").hide(),jQuery("#recipe-instructions tr.instruction:first").find("span.instructions-delete").hide(),calculateIngredientGroups(),jQuery("#ingredients-add-group").on("click",function(e){e.preventDefault(),addRecipeIngredientGroup()}),jQuery(".ingredient-group-label").on("input",function(){window.clearTimeout(e),e=window.setTimeout(function(){calculateIngredientGroups()},500)}),jQuery(".ingredient-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),calculateIngredientGroups()}),calculateInstructionGroups(),jQuery("#instructions-add-group").on("click",function(e){e.preventDefault(),addRecipeInstructionGroup()}),jQuery(".instruction-group-label").on("input",function(){window.clearTimeout(t),t=window.setTimeout(function(){calculateInstructionGroups()},500)}),jQuery("#recipe-ingredients tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){calculateIngredientGroups(),updateIngredientIndex()}}),jQuery(".ingredients-delete").on("click",function(){jQuery(this).parents("tr").remove(),updateIngredientIndex()}),jQuery("#ingredients-add").on("click",function(e){e.preventDefault(),addRecipeIngredient()}),jQuery("#recipe-ingredients").on("keydown",".ingredients_notes, .ingredient-group-label",function(e){if(console.log("%c Found keypress on "+jQuery(this).attr("class")+jQuery(this).attr("id"),"background:#CCC;color:blue"),9==(e.keyCode||e.which)&&0==e.shiftKey){var t=jQuery(this).closest("tr");console.log("currentRow = "+t.prop("tagName")+t.attr("class")),e.preventDefault(),isLastIngredient(t)?addRecipeIngredient(t):(console.log("ingredient.next.focus"),t.next().focus())}}),jQuery("#recipe-ingredients .ingredients_amount").on("keydown",function(e){var t=e.keyCode||e.which,i=(jQuery("#recipe-ingredients tr:last").attr("id"),jQuery(this).closest("tr.ingredient")),n=i.attr("id");if(console.log("Current ingredient : "+n),9==t&&1==e.shiftKey){event.preventDefault();var r=i.prev();r.focus();r.attr("id")}}),jQuery("#recipe-instructions tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){calculateInstructionGroups(),updateInstructionIndex()}}),jQuery(".instructions-delete").on("click",function(){jQuery(this).parents("tr").remove(),updateInstructionIndex()}),jQuery("#instructions-add").on("click",function(e){e.preventDefault(),addRecipeInstruction()}),jQuery("#recipe-instructions .instruction:last-of-type .instruction-text").on("keydown",function(e){9==(e.keyCode||e.which)&&0==e.shiftKey&&(e.preventDefault(),addRecipeInstruction())}),jQuery(".recipe_thumbnail_add_image").on("click",function(e){e.preventDefault();var t=jQuery(this);if(image=t.siblings(".recipe_thumbnail_image"),preview=t.siblings(".recipe_thumbnail"),"function"==typeof wp.media)var i=wp.media({title:"Insert Media",button:{text:"Add featured image"},multiple:!1}).on("select",function(){var e=i.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id).trigger("change")}).open();else post_id=t.attr("rel"),tb_show(t.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()}}),jQuery(".recipe_thumbnail_remove_image").on("click",function(e){e.preventDefault();var t=jQuery(this);t.siblings(".recipe_thumbnail_image").val("").trigger("change"),t.siblings(".recipe_thumbnail").attr("src",wpurp_recipe_form.coreUrl+"/img/image_placeholder.png")}),jQuery(".recipe_thumbnail_image").on("change",function(){var e=jQuery(this);""==e.val()?(e.siblings(".recipe_thumbnail_add_image").removeClass("wpurp-hide"),e.siblings(".recipe_thumbnail_remove_image").addClass("wpurp-hide")):(e.siblings(".recipe_thumbnail_remove_image").removeClass("wpurp-hide"),e.siblings(".recipe_thumbnail_add_image").addClass("wpurp-hide"))}),jQuery(".recipe-instructions-container").on("change","input.recipe_instructions_image",function(){PreviewImage(jQuery(this).attr("id").match(/\d+/))}),jQuery("#wpurp-insert-recipe").on("click",function(){var e="[ultimate-recipe id=";e+=jQuery("#wpurp-recipe").find("option:selected").val(),e+="]",tinyMCE.activeEditor.execCommand("mceInsertContent",0,e),tinyMCE.activeEditor.windowManager.close()}),jQuery(".wpurp-file-remove").on("click",function(e){e.preventDefault();var t=jQuery(this);preview=t.siblings("img"),fieldname=preview.attr("class"),t.siblings("."+fieldname+"_image").val(""),t.siblings("."+fieldname).attr("src",""),t.siblings(".wpurp-file-upload").removeClass("wpurp-hide"),t.addClass("wpurp-hide")})}),jQuery(".instruction-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),calculateInstructionGroups()});