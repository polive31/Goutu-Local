var currentRowId,previousRowId,xhr_ingredient=[];function isValid(id){var isValid=!0,thisIngredient,inputField;return null==getIngredientbyId(id).find(".name input").val()&&(isValid=!1),console.log("Is Valid = "+isValid),isValid}function getIngredientbyId(id){return jQuery("#recipe-ingredients").find("#"+id)}function displayIngredientPreview(thisIngredientId){console.log("%c Display Ingredient Preview on "+thisIngredientId,"background: #ccc; color: blue");var thisIngredient=getIngredientbyId(thisIngredientId),recipeId=jQuery("#submit_post_id").val(),ingredientName=thisIngredient.find(".ingredient-input.name input").val();if(console.log("%c Ingredient name = "+ingredientName,"background: #ccc; color: blue"),""!=ingredientName){var ingredientData=thisIngredient.find("input, textarea").serialize();console.table("Ingredient data = ",ingredientData);try{xhr_ingredient[thisIngredientId].abort(),console.log("%c Aborting previous ajax call for "+thisIngredientId,"background: #ccc; color: blue")}catch(e){console.log("%c No previous ajax call for "+thisIngredientId,"background: #ccc; color: blue")}console.log("%c Ajax call launched","background: #ccc; color: blue"),console.log("%c Recipe ID="+recipeId,"background: #ccc; color: blue");var data={action:"ingredient_preview",security:ingredient_preview.nonce,recipe_id:recipeId,ingredient_data:ingredientData};xhr_ingredient[thisIngredientId]=jQuery.post(ingredient_preview.ajaxurl,data,(function(response){if(response.success){console.log("%c Ajax ingredient preview success for "+thisIngredientId,"background: #ccc; color: blue"),console.log("%c Response is "+response.data.msg,"background: #ccc; color: blue");var target=thisIngredient.find("td.ingredient-preview");jQuery("#recipe-ingredients").on("focusin","tr.ingredient",!1),jQuery("#recipe-ingredients").on("blur","tr.ingredient",!1),target.html(response.data.msg),thisIngredient.removeClass("edit new"),thisIngredient.addClass("saved"),jQuery("#recipe-ingredients").off("focusin","tr.ingredient",!1),jQuery("#recipe-ingredients").off("blur","tr.ingredient",!1)}else console.log("%c Error on Ajax call processing : "+response.data.msg,"background: #ccc; color: blue")}))}else console.log("%c Exit...","background: #ccc; color: blue")}jQuery(document).ready((function(){jQuery("#recipe-ingredients").on("focusin","tr.ingredient",(function(){currentRowId=jQuery(this).attr("id"),jQuery(this).removeClass("saved new"),jQuery(this).addClass("edit")})),jQuery("#recipe-ingredients").on("blur","tr.ingredient",(function(){var rowId;currentRowId=-1,previousRowId=jQuery(this).attr("id"),setTimeout((function(){console.log("after timeout variables are : ",previousRowId,currentRowId),previousRowId!=currentRowId&&isValid(previousRowId)&&displayIngredientPreview(previousRowId)}),100)})),jQuery(document).on("click","tr.saved",(function(){console.log("%c Click on tr.ingredient.saved"+jQuery(this).attr("id"),"background:#D7EEC0;color:green"),jQuery(this).focus()}))}));