!function($,window,document,undefined){"use strict";var cssTransitionSupport=function(){var s,s;return""==(s=(s=document.body||document.documentElement).style).WebkitTransition?"-webkit-":""==s.MozTransition?"-moz-":""==s.OTransition?"-o-":""==s.transition&&""},isCssTransitionSupport=!1!==cssTransitionSupport(),cssTransitionTranslateX=function(element,positionX,speed){var options={},prefix=cssTransitionSupport();options[prefix+"transform"]="translateX("+positionX+")",options[prefix+"transition"]=prefix+"transform "+speed+"s linear",element.css(options)},hasTouch="ontouchstart"in window,hasPointers=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,wasTouched=function(event){if(hasTouch)return!0;if(!hasPointers||void 0===event||void 0===event.pointerType)return!1;if(void 0!==event.MSPOINTER_TYPE_MOUSE){if(event.MSPOINTER_TYPE_MOUSE!=event.pointerType)return!0}else if("mouse"!=event.pointerType)return!0;return!1};$.fn.imageLightbox=function(options){var options=$.extend({selector:'id="imagelightbox"',animationSpeed:250,preloadNext:!0,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1},options),targets=$([]),target=$(),image=$(),imageWidth=0,imageHeight=0,swipeDiff=0,inProgress=!1,setImage=function(){if(!image.length)return!0;var screenWidth=.8*$(window).width(),screenHeight=.9*$(window).height(),tmpImage=new Image;tmpImage.src=image.attr("src"),tmpImage.onload=function(){if(imageWidth=tmpImage.width,imageHeight=tmpImage.height,imageWidth>screenWidth||imageHeight>screenHeight){var ratio=imageWidth/imageHeight>screenWidth/screenHeight?imageWidth/screenWidth:imageHeight/screenHeight;imageWidth/=ratio,imageHeight/=ratio}image.css({width:imageWidth+"px",height:imageHeight+"px",top:($(window).height()-imageHeight)/2+"px",left:($(window).width()-imageWidth)/2+"px"})}},loadImage=function(direction){if(inProgress)return!1;if(direction=void 0!==direction&&("left"==direction?1:-1),image.length){if(!1!==direction&&(targets.length<2||!0===options.quitOnEnd&&(-1===direction&&0==targets.index(target)||1===direction&&targets.index(target)==targets.length-1)))return quitLightbox(),!1;var params={opacity:0};isCssTransitionSupport?cssTransitionTranslateX(image,100*direction-swipeDiff+"px",options.animationSpeed/1e3):params.left=parseInt(image.css("left"))+100*direction+"px",image.animate(params,options.animationSpeed,(function(){removeImage()})),swipeDiff=0}inProgress=!0,!1!==options.onLoadStart&&options.onLoadStart(),setTimeout((function(){image=$("<img "+options.selector+" />").attr({src:target.attr("href"),"data-id":targets.index(target)}).on("load",(function(){image.appendTo("body"),setImage();var params={opacity:1};if(image.css("opacity",0),isCssTransitionSupport)cssTransitionTranslateX(image,-100*direction+"px",0),setTimeout((function(){cssTransitionTranslateX(image,"0px",options.animationSpeed/1e3)}),50);else{var imagePosLeft=parseInt(image.css("left"));params.left=imagePosLeft+"px",image.css("left",imagePosLeft-100*direction+"px")}if(image.animate(params,options.animationSpeed,(function(){inProgress=!1,!1!==options.onLoadEnd&&options.onLoadEnd()})),options.preloadNext){var nextTarget=targets.eq(targets.index(target)+1);nextTarget.length||(nextTarget=targets.eq(0)),$("<img />").attr("src",nextTarget.attr("href"))}})).on("error",(function(){!1!==options.onLoadEnd&&options.onLoadEnd()}));var swipeStart=0,swipeEnd=0,imagePosLeft=0;image.on(hasPointers?"pointerup MSPointerUp":"click",(function(e){if(e.preventDefault(),options.quitOnImgClick)return quitLightbox(),!1;if(wasTouched(e.originalEvent))return!0;var posX=(e.pageX||e.originalEvent.pageX)-e.target.offsetLeft;(target=targets.eq(targets.index(target)-(imageWidth/2>posX?1:-1))).length||(target=targets.eq(imageWidth/2>posX?targets.length:0)),loadImage(imageWidth/2>posX?"left":"right")})).on("touchstart pointerdown MSPointerDown",(function(e){if(!wasTouched(e.originalEvent)||options.quitOnImgClick)return!0;isCssTransitionSupport&&(imagePosLeft=parseInt(image.css("left"))),swipeStart=e.originalEvent.pageX||e.originalEvent.touches[0].pageX})).on("touchmove pointermove MSPointerMove",(function(e){if(!wasTouched(e.originalEvent)||options.quitOnImgClick)return!0;e.preventDefault(),swipeEnd=e.originalEvent.pageX||e.originalEvent.touches[0].pageX,swipeDiff=swipeStart-swipeEnd,isCssTransitionSupport?cssTransitionTranslateX(image,-swipeDiff+"px",0):image.css("left",imagePosLeft-swipeDiff+"px")})).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",(function(e){if(!wasTouched(e.originalEvent)||options.quitOnImgClick)return!0;Math.abs(swipeDiff)>50?((target=targets.eq(targets.index(target)-(swipeDiff<0?1:-1))).length||(target=targets.eq(swipeDiff<0?targets.length:0)),loadImage(swipeDiff>0?"right":"left")):isCssTransitionSupport?cssTransitionTranslateX(image,"0px",options.animationSpeed/1e3):image.animate({left:imagePosLeft+"px"},options.animationSpeed/2)}))}),options.animationSpeed+100)},removeImage=function(){if(!image.length)return!1;image.remove(),image=$()},quitLightbox=function(){if(!image.length)return!1;image.animate({opacity:0},options.animationSpeed,(function(){removeImage(),inProgress=!1,!1!==options.onEnd&&options.onEnd()}))},addTargets=function(newTargets){newTargets.each((function(){targets=targets.add($(this))})),newTargets.on("click.imageLightbox",(function(e){if(e.preventDefault(),inProgress)return!1;inProgress=!1,!1!==options.onStart&&options.onStart(),target=$(this),loadImage()}))};return $(window).on("resize",setImage),options.quitOnDocClick&&$(document).on(hasTouch?"touchend":"click",(function(e){image.length&&!$(e.target).is(image)&&quitLightbox()})),options.enableKeyboard&&$(document).on("keyup",(function(e){if(!image.length)return!0;e.preventDefault(),27==e.keyCode&&quitLightbox(),37!=e.keyCode&&39!=e.keyCode||((target=targets.eq(targets.index(target)-(37==e.keyCode?1:-1))).length||(target=targets.eq(37==e.keyCode?targets.length:0)),loadImage(37==e.keyCode?"left":"right"))})),addTargets($(this)),this.switchImageLightbox=function(index){var tmpTarget=targets.eq(index);if(tmpTarget.length){var currentIndex=targets.index(target);target=tmpTarget,loadImage(index<currentIndex?"left":"right")}return this},this.addToImageLightbox=function(newTargets){addTargets(newTargets)},this.quitImageLightbox=function(){return quitLightbox(),this},this}}(jQuery,window,document);