function autoSuggestIngredient(e){term=e.val(),id=e.attr("id"),tax="ingredient",spinnerHTML=e.closest("td").next().children(".ajax-indicator"),spinnerHTML.css("visibility","hidden"),jQuery("#"+id).autoComplete({minChars:3,delay:200,source:function(e,i){spinnerHTML.css("visibility","visible");try{xhr.abort()}catch(e){}xhr=jQuery.ajax({dataType:"json",url:"/wp-admin/admin-ajax.php",data:"action=get_tax_terms&tax="+tax+"&keys="+e,success:function(e){i(e),spinnerHTML.css("visibility","hidden")}})}})}function PreviewImage(e){var i=new FileReader;i.readAsDataURL(document.getElementById("recipe_thumbnail_input_"+e).files[0]),i.onload=function(i){document.getElementById("instruction_thumbnail_preview_"+e).src=i.target.result}}jQuery(document).ready(function(){jQuery(document).on("input",".ingredients_name",function(){autoSuggestIngredient(jQuery(this))}),jQuery("input.ingredients_name").focusout(function(){spinnerHTML=jQuery(this).closest("td").next().children(".ajax-indicator"),spinnerHTML.css("visibility","hidden");try{xhr.abort()}catch(e){}}),jQuery("#wpurp_user_submission_form select").select2({allowClear:!0,width:"off",dropdownAutoWidth:!1,minimumResultsForSearch:-1}),jQuery(".taxonomy-select-boxes").removeClass("nodisplay"),jQuery(".taxonomy-select-spinner").addClass("nodisplay"),jQuery("#insert-recipe-shortcode").on("click",function(){t("[recipe]")}),jQuery("#insert-nutrition-shortcode").on("click",function(){t("[nutrition-label]")});var e,i,n=jQuery("textarea#content");function t(e){if(!tinyMCE.activeEditor||tinyMCE.activeEditor.isHidden()){var i=n.val();n.val(i+e)}else tinyMCE.execCommand("mceInsertContent",!1,e)}function r(){1==jQuery(".ingredient-group").length?(jQuery("#recipe-ingredients .ingredient .ingredients_group").val(""),jQuery(".ingredient-groups-disabled").show(),jQuery(".ingredient-groups-enabled").hide()):(jQuery("#recipe-ingredients tr.ingredient").each(function(e,i){var n=jQuery(i).prevAll(".ingredient-group:first").find(".ingredient-group-label").val();void 0===n&&(n=jQuery(".ingredient-group-first").find(".ingredient-group-label").val()),jQuery(i).find(".ingredients_group").val(n)}),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show())}function u(){1==jQuery(".instruction-group").length?(jQuery("#recipe-instructions .instruction .instructions_group").val(""),jQuery(".instruction-groups-disabled").show(),jQuery(".instruction-groups-enabled").hide()):(jQuery("#recipe-instructions tr.instruction").each(function(e,i){var n=jQuery(i).prevAll(".instruction-group:first").find(".instruction-group-label").val();void 0===n&&(n=jQuery(".instruction-group-first").find(".instruction-group-label").val()),jQuery(i).find(".instructions_group").val(n)}),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show())}function s(){var e=jQuery("#recipe-ingredients tr.ingredient").length,i=jQuery("#recipe-ingredients tr:last"),n=jQuery("#recipe-ingredients tr.ingredient:last");n.find("input").attr("placeholder","");var t=n.clone(!0);t.insertAfter(i).find("input, select").val("").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)}).parent().find("input.ingredients_name").attr("onfocus",function(i,n){return n.replace(/(\d+)/,e)}),t.find("span.ingredients-delete").show(),a(),jQuery("#recipe-ingredients tr:last .ingredients_amount").focus(),r()}function a(){jQuery("#recipe-ingredients .ingredients_notes").unbind("keydown").last().bind("keydown",function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),s())})}function o(){jQuery("#recipe-ingredients tr.ingredient").each(function(e){jQuery(this).find("input").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)}).parent().find("input.ingredients_name").attr("onfocus",function(i,n){return n.replace(/(\d+)/,e)})})}function c(){var e=jQuery("#recipe-instructions tr.instruction").length,i=jQuery("#recipe-instructions tr.instruction:last").clone(!0);i.insertAfter("#recipe-instructions tr:last").find("textarea").val("").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)}),i.find(".recipe_instructions_remove_image").addClass("wpurp-hide"),i.find(".recipe_instructions_add_image").removeClass("wpurp-hide"),i.find(".recipe_instructions_thumbnail").val(""),i.find(".recipe_instructions_image").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)}).val(null),i.find(".recipe_instructions_thumbnail").attr("id",function(i,n){return n.replace(/(\d+)/,e)}).attr("src",custom_user_submissions.placeholder),i.find(".instructions_group").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)}),i.find("span.instructions-delete").show(),d(),jQuery("#recipe-instructions tr:last textarea").focus(),u()}function d(){jQuery("#recipe-instructions textarea").unbind("keydown").last().bind("keydown",function(e){9==(e.keyCode||e.which)&&0==e.shiftKey&&(1==jQuery("#recipe-instructions tr:last").find("textarea").is(":focus")&&(e.preventDefault(),c()))})}function l(){jQuery("#recipe-instructions tr.instruction").each(function(e){jQuery(this).find("textarea").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)}),jQuery(this).find(".recipe_instructions_image").attr("name",function(i,n){return n.replace(/(\d+)/,e)}),jQuery(this).find(".instructions_group").attr("name",function(i,n){return n.replace(/(\d+)/,e)}).attr("id",function(i,n){return n.replace(/(\d+)/,e)})})}jQuery("#recipe-ingredients tr.ingredient:first").find("span.ingredients-delete").hide(),jQuery("#recipe-instructions tr.instruction:first").find("span.instructions-delete").hide(),r(),jQuery("#ingredients-add-group").on("click",function(e){var i,n;e.preventDefault(),i=jQuery("#recipe-ingredients tr.ingredient-group-stub"),n=jQuery("#recipe-ingredients tr:last"),i.clone(!0).insertAfter(n).removeClass("ingredient-group-stub").addClass("ingredient-group"),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show(),r()}),jQuery(".ingredient-group-label").on("input",function(){window.clearTimeout(e),e=window.setTimeout(function(){r()},500)}),jQuery(".ingredient-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),r()}),u(),jQuery("#instructions-add-group").on("click",function(e){var i,n;e.preventDefault(),i=jQuery("#recipe-instructions tr.instruction-group-stub"),n=jQuery("#recipe-instructions tr:last"),i.clone(!0).insertAfter(n).removeClass("instruction-group-stub").addClass("instruction-group"),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show(),u()}),jQuery(".instruction-group-label").on("input",function(){window.clearTimeout(i),i=window.setTimeout(function(){u()},500)}),jQuery(".instruction-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),u()}),jQuery("#recipe-ingredients tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){a(),r(),o()}}),jQuery("#recipe-ingredients").on("keydown",function(e){9==(e.keyCode||e.which)&&jQuery("ul.ac_results").hide()}),jQuery("#recipe-ingredients").on("click",function(){jQuery("ul.ac_results").hide()}),jQuery(".ingredients-delete").on("click",function(){jQuery(this).parents("tr").remove(),a(),o()}),jQuery("#ingredients-add").on("click",function(e){e.preventDefault(),s()}),a(),jQuery("#recipe-instructions tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){d(),u(),l()}}),jQuery(".instructions-delete").on("click",function(){jQuery(this).parents("tr").remove(),d(),l()}),jQuery("#instructions-add").on("click",function(e){e.preventDefault(),c()}),d(),jQuery(".recipe_thumbnail_add_image").on("click",function(e){e.preventDefault();var i=jQuery(this);if(image=i.siblings(".recipe_thumbnail_image"),preview=i.siblings(".recipe_thumbnail"),"function"==typeof wp.media)var n=wp.media({title:"Insert Media",button:{text:"Add featured image"},multiple:!1}).on("select",function(){var e=n.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id).trigger("change")}).open();else post_id=i.attr("rel"),tb_show(i.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()}}),jQuery(".recipe_thumbnail_remove_image").on("click",function(e){e.preventDefault();var i=jQuery(this);i.siblings(".recipe_thumbnail_image").val("").trigger("change"),i.siblings(".recipe_thumbnail").attr("src",wpurp_recipe_form.coreUrl+"/img/image_placeholder.png")}),jQuery(".recipe_thumbnail_image").on("change",function(){var e=jQuery(this);""==e.val()?(e.siblings(".recipe_thumbnail_add_image").removeClass("wpurp-hide"),e.siblings(".recipe_thumbnail_remove_image").addClass("wpurp-hide")):(e.siblings(".recipe_thumbnail_remove_image").removeClass("wpurp-hide"),e.siblings(".recipe_thumbnail_add_image").addClass("wpurp-hide"))}),jQuery(".recipe-instructions-container").on("change","input.recipe_instructions_image",function(){PreviewImage(jQuery(this).attr("id").match(/\d+/))}),jQuery("#wpurp-insert-recipe").on("click",function(){var e="[ultimate-recipe id=";e+=jQuery("#wpurp-recipe").find("option:selected").val(),e+="]",tinyMCE.activeEditor.execCommand("mceInsertContent",0,e),tinyMCE.activeEditor.windowManager.close()}),jQuery(".wpurp-file-remove").on("click",function(e){e.preventDefault();var i=jQuery(this);preview=i.siblings("img"),fieldname=preview.attr("class"),i.siblings("."+fieldname+"_image").val(""),i.siblings("."+fieldname).attr("src",""),i.siblings(".wpurp-file-upload").removeClass("wpurp-hide"),i.addClass("wpurp-hide")})});