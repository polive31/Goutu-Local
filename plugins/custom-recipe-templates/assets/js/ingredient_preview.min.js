var currentRowId,previousRowId,xhr_ingredient=[];function isValid(e){var n=!0;return 0==getIngredientbyId(e).find(".name input").val().length&&(n=!1),console.log("Is Valid = "+n),n}function getIngredientbyId(e){return jQuery("#recipe-ingredients").find("#"+e)}function displayIngredientPreview(e){console.log("%c Display Ingredient Preview on "+e,"background: #ccc; color: blue");var n=getIngredientbyId(e);try{xhr_ingredient[e].abort(),console.log("%c Aborting previous ajax call for "+e,"background: #ccc; color: blue")}catch(n){console.log("%c No previous ajax call for "+e,"background: #ccc; color: blue")}console.log("%c Ajax call launched","background: #ccc; color: blue"),xhr_ingredient[e]=jQuery.ajax({url:ingredient_preview.ajaxurl,method:"POST",data:{action:"ingredient_preview",security:ingredient_preview.nonce,amount:n.find(".ingredients_amount").val(),unit:n.find(".ingredients_unit").val(),ingredient:n.find(".ingredients_name").val(),notes:n.find(".ingredients_notes").val()},success:function(r){if(r.success){console.log("Ajax ingredient preview success for "+e),console.log("Ingredient is "+n);var i=n.find("td.ingredient-preview");jQuery("#recipe-ingredients").on("focusin","tr.ingredient",!1),jQuery("#recipe-ingredients").on("blur","tr.ingredient",!1),i.html(r.data.msg),n.removeClass("edit new"),n.addClass("saved"),jQuery("#recipe-ingredients").off("focusin","tr.ingredient",!1),jQuery("#recipe-ingredients").off("blur","tr.ingredient",!1)}else console.log("Error on Ajax call processing : "+r.data.msg)},error:function(e){console.log("Ajax call failed : "+e.msg)}})}jQuery(document).ready(function(){jQuery("#recipe-ingredients").on("focusin","tr.ingredient",function(){currentRowId=jQuery(this).attr("id"),jQuery(this).removeClass("saved new"),jQuery(this).addClass("edit")}),jQuery("#recipe-ingredients").on("blur","tr.ingredient",function(){currentRowId=-1,previousRowId=jQuery(this).attr("id"),setTimeout(function(){console.log("after timeout variables are : ",previousRowId,currentRowId),previousRowId!=currentRowId&&isValid(previousRowId)&&displayIngredientPreview(previousRowId)},100)}),jQuery(document).on("click","tr.saved",function(){console.log("%c Click on tr.ingredient.saved"+jQuery(this).attr("id"),"background:#D7EEC0;color:green"),jQuery(this).focus()})});