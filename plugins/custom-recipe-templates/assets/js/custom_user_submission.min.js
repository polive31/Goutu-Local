jQuery(document).ready(function(){jQuery("select").select2({allowClear:!0,width:"off",dropdownAutoWidth:!1,minimumResultsForSearch:-1,closeOnSelect:!1})}),jQuery(document).ready(function(){jQuery(".taxonomy-select-boxes").removeClass("nodisplay"),jQuery(".taxonomy-select-spinner").addClass("nodisplay"),jQuery("#insert-recipe-shortcode").on("click",function(){n("[recipe]")}),jQuery("#insert-nutrition-shortcode").on("click",function(){n("[nutrition-label]")});var e,i,r=jQuery("textarea#content");function n(e){if(!tinyMCE.activeEditor||tinyMCE.activeEditor.isHidden()){var i=r.val();r.val(i+e)}else tinyMCE.execCommand("mceInsertContent",!1,e)}function t(){1==jQuery(".ingredient-group").length?(jQuery("#recipe-ingredients .ingredient .ingredients_group").val(""),jQuery(".ingredient-groups-disabled").show(),jQuery(".ingredient-groups-enabled").hide()):(jQuery("#recipe-ingredients tr.ingredient").each(function(e,i){var r=jQuery(i).prevAll(".ingredient-group:first").find(".ingredient-group-label").val();void 0===r&&(r=jQuery(".ingredient-group-first").find(".ingredient-group-label").val()),jQuery(i).find(".ingredients_group").val(r)}),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show())}function u(){1==jQuery(".instruction-group").length?(jQuery("#recipe-instructions .instruction .instructions_group").val(""),jQuery(".instruction-groups-disabled").show(),jQuery(".instruction-groups-enabled").hide()):(jQuery("#recipe-instructions tr.instruction").each(function(e,i){var r=jQuery(i).prevAll(".instruction-group:first").find(".instruction-group-label").val();void 0===r&&(r=jQuery(".instruction-group-first").find(".instruction-group-label").val()),jQuery(i).find(".instructions_group").val(r)}),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show())}function s(){var e=jQuery("#recipe-ingredients tr.ingredient").length,i=jQuery("#recipe-ingredients tr:last"),r=jQuery("#recipe-ingredients tr.ingredient:last");r.find("input").attr("placeholder","");var n=r.clone(!0);n.insertAfter(i).find("input, select").val("").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}).parent().find("input.ingredients_name").attr("onfocus",function(i,r){return r.replace(/(\d+)/,e)}),n.find("span.ingredients-delete").show(),a(),jQuery("#recipe-ingredients tr:last .ingredients_amount").focus(),t()}function a(){jQuery("#recipe-ingredients .ingredients_notes").unbind("keydown").last().bind("keydown",function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),s())})}function o(){jQuery("#recipe-ingredients tr.ingredient").each(function(e){jQuery(this).find("input").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}).parent().find("input.ingredients_name").attr("onfocus",function(i,r){return r.replace(/(\d+)/,e)})})}function c(){var e=jQuery("#recipe-instructions tr.instruction").length,i=jQuery("#recipe-instructions tr.instruction:last").clone(!0);i.insertAfter("#recipe-instructions tr:last").find("textarea").val("").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}),i.find(".recipe_instructions_remove_image").addClass("wpurp-hide"),i.find(".recipe_instructions_add_image").removeClass("wpurp-hide"),i.find(".recipe_instructions_thumbnail").val(""),i.find(".recipe_instructions_image").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}).val(null),i.find(".recipe_instructions_thumbnail").attr("id",function(i,r){return r.replace(/(\d+)/,e)}).attr("src",custom_user_submissions.placeholder),i.find(".instructions_group").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}),i.find("span.instructions-delete").show(),d(),jQuery("#recipe-instructions tr:last textarea").focus(),u()}function d(){jQuery("#recipe-instructions textarea").unbind("keydown").last().bind("keydown",function(e){9==(e.keyCode||e.which)&&0==e.shiftKey&&(1==jQuery("#recipe-instructions tr:last").find("textarea").is(":focus")&&(e.preventDefault(),c()))})}function l(){jQuery("#recipe-instructions tr.instruction").each(function(e){jQuery(this).find("textarea").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}),jQuery(this).find(".recipe_instructions_image").attr("name",function(i,r){return r.replace(/(\d+)/,e)}),jQuery(this).find(".instructions_group").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)})})}jQuery("#recipe-ingredients tr.ingredient:first").find("span.ingredients-delete").hide(),jQuery("#recipe-instructions tr.instruction:first").find("span.instructions-delete").hide(),t(),jQuery("#ingredients-add-group").on("click",function(e){var i,r;e.preventDefault(),i=jQuery("#recipe-ingredients tr.ingredient-group-stub"),r=jQuery("#recipe-ingredients tr:last"),i.clone(!0).insertAfter(r).removeClass("ingredient-group-stub").addClass("ingredient-group"),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show(),t()}),jQuery(".ingredient-group-label").on("input",function(){window.clearTimeout(e),e=window.setTimeout(function(){t()},500)}),jQuery(".ingredient-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),t()}),u(),jQuery("#instructions-add-group").on("click",function(e){var i,r;e.preventDefault(),i=jQuery("#recipe-instructions tr.instruction-group-stub"),r=jQuery("#recipe-instructions tr:last"),i.clone(!0).insertAfter(r).removeClass("instruction-group-stub").addClass("instruction-group"),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show(),u()}),jQuery(".instruction-group-label").on("input",function(){window.clearTimeout(i),i=window.setTimeout(function(){u()},500)}),jQuery(".instruction-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),u()}),jQuery("#recipe-ingredients tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){a(),t(),o()}}),jQuery("#recipe-ingredients").on("keydown",function(e){9==(e.keyCode||e.which)&&jQuery("ul.ac_results").hide()}),jQuery("#recipe-ingredients").on("click",function(){jQuery("ul.ac_results").hide()}),jQuery(".ingredients-delete").on("click",function(){jQuery(this).parents("tr").remove(),a(),o()}),jQuery("#ingredients-add").on("click",function(e){e.preventDefault(),s()}),a(),jQuery("#recipe-instructions tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){d(),u(),l()}}),jQuery(".instructions-delete").on("click",function(){jQuery(this).parents("tr").remove(),d(),l()}),jQuery("#instructions-add").on("click",function(e){e.preventDefault(),c()}),d(),jQuery(".recipe_thumbnail_add_image").on("click",function(e){e.preventDefault();var i=jQuery(this);if(image=i.siblings(".recipe_thumbnail_image"),preview=i.siblings(".recipe_thumbnail"),"function"==typeof wp.media)var r=wp.media({title:"Insert Media",button:{text:"Add featured image"},multiple:!1}).on("select",function(){var e=r.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id).trigger("change")}).open();else post_id=i.attr("rel"),tb_show(i.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()}}),jQuery(".recipe_thumbnail_remove_image").on("click",function(e){e.preventDefault();var i=jQuery(this);i.siblings(".recipe_thumbnail_image").val("").trigger("change"),i.siblings(".recipe_thumbnail").attr("src",wpurp_recipe_form.coreUrl+"/img/image_placeholder.png")}),jQuery(".recipe_thumbnail_image").on("change",function(){var e=jQuery(this);""==e.val()?(e.siblings(".recipe_thumbnail_add_image").removeClass("wpurp-hide"),e.siblings(".recipe_thumbnail_remove_image").addClass("wpurp-hide")):(e.siblings(".recipe_thumbnail_remove_image").removeClass("wpurp-hide"),e.siblings(".recipe_thumbnail_add_image").addClass("wpurp-hide"))}),jQuery(".recipe_instructions_add_image").on("click",function(e){e.preventDefault();var i=jQuery(this);if(image=i.siblings(".recipe_instructions_image"),preview=i.siblings(".recipe_instructions_thumbnail"),"function"==typeof wp.media)var r=wp.media({title:"Insert Media",button:{text:"Add instruction image"},multiple:!1}).on("select",function(){var e=r.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id).trigger("change")}).open();else post_id=i.attr("rel"),tb_show(i.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()}}),jQuery(".recipe_instructions_remove_image").on("click",function(e){e.preventDefault();var i=jQuery(this);i.siblings(".recipe_instructions_image").val("").trigger("change"),i.siblings(".recipe_instructions_thumbnail").attr("src",wpurp_recipe_form.coreUrl+"/img/image_placeholder.png")}),jQuery(".recipe_instructions_image").on("change",function(){var e=jQuery(this);""==e.val()?(e.siblings(".recipe_instructions_add_image").removeClass("wpurp-hide"),e.siblings(".recipe_instructions_remove_image").addClass("wpurp-hide")):(e.siblings(".recipe_instructions_remove_image").removeClass("wpurp-hide"),e.siblings(".recipe_instructions_add_image").addClass("wpurp-hide"))}),jQuery("#wpurp-insert-recipe").on("click",function(){var e="[ultimate-recipe id=";e+=jQuery("#wpurp-recipe").find("option:selected").val(),e+="]",tinyMCE.activeEditor.execCommand("mceInsertContent",0,e),tinyMCE.activeEditor.windowManager.close()}),jQuery(".wpurp-file-remove").on("click",function(e){e.preventDefault();var i=jQuery(this);preview=i.siblings("img"),fieldname=preview.attr("class"),i.siblings("."+fieldname+"_image").val(""),i.siblings("."+fieldname).attr("src",""),i.siblings(".wpurp-file-upload").removeClass("wpurp-hide"),i.addClass("wpurp-hide")})});