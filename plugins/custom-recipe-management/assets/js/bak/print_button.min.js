var RecipePrintButton=RecipePrintButton||{};RecipePrintButton.update=function(recipe){recipe.find(".wpurp-recipe-print-button").each((function(){var button=jQuery(this),link=button.data("original-link");link||(link=button.attr("href"),button.data("original-link",link));var separator=wpurp_print.permalinks?"/":"=";link.slice(-1)!=separator&&(link+=separator);var system=recipe.find("select.adjust-recipe-unit:visible option:selected").text(),system_link;system&&(link+=system.toLowerCase().replace(/ /g,"-").replace(/[-]+/g,"-").replace(/[^\w-]+/g,"")+"/");var servings_input=recipe.find("input.adjust-recipe-servings:visible");0==servings_input.length&&(servings_input=recipe.find("input.advanced-adjust-recipe-servings:visible")),0!=servings_input.length&&(link+=servings_input.val()),button.attr("href",link)}))},jQuery(document).ready((function(){jQuery(document).on("click",".wpurp-recipe-print-button, .wpurp-print-recipe-shortcode",(function(e){console.log("In print_button.js, click on recipe print !");var recipeId=jQuery(this).data("recipe-id");if(recipeId){e.preventDefault(),e.stopPropagation();var recipe=jQuery(this).parents(".wpurp-container");wpurp_print.servings_original=parseFloat(recipe.data("servings-original")),wpurp_print.old_system=parseInt(recipe.data("system-original")),wpurp_print.new_system=recipe.find("select.adjust-recipe-unit option:selected").val(),wpurp_print.rtl=jQuery("body").hasClass("rtl");var servings_input=recipe.find("input.adjust-recipe-servings");0==servings_input.length&&(servings_input=recipe.find("input.advanced-adjust-recipe-servings")),0==servings_input.length?wpurp_print.servings_new=wpurp_print.servings_original:wpurp_print.servings_new=parseFloat(servings_input.val()),wpurp_print.template="";var data={action:"get_recipe_template",security:wpurp_print.nonce,recipe_id:recipeId};jQuery.post(wpurp_print.ajaxurl,data,(function(template){wpurp_print.template=template.output,wpurp_print.fonts=template.fonts}),"json"),window.open(wpurp_print.coreUrl+"/templates/print.php","_blank")}}))}));