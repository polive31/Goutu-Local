function isLastIngredient(e){console.log("%c In isLastIngredient","background:#CCC;color:red;padding:10px;border-radius:2px"),console.log("item = "+e.attr("id"));var n=e.next(".ingredient-group").length;console.log("next group = "+e.next(".ingredient-group").prop("tagName")),console.log("has group after = "+n),console.log("#recipe-ingredients tr:last");var t=e.attr("id")==jQuery("#recipe-ingredients tr:last").attr("id");return console.log("is last ingredient = "+t),n||t}function PreviewImage(e){var n=document.getElementById("recipe_thumbnail_input_"+e);if(n.files&&n.files[0]){var t=n.files[0].name.split(".").pop().toLowerCase();if(custom_user_submissions.fileTypes.indexOf(t)>-1){var r=n.files[0].size/1024;if(console.log("File size (kB) = "+document.getElementById("recipe_thumbnail_input_"+e).files[0].size/1024),r<custom_user_submissions.maxFileSize){var i=new FileReader;i.readAsDataURL(n.files[0]),i.onload=function(n){document.getElementById("recipe_thumbnail_preview_"+e).src=n.target.result}}else jQuery(n).val(""),alert(custom_user_submissions.fileTooBig)}else jQuery(n).val(""),alert(custom_user_submissions.wrongFileType)}}function addRecipeIngredientGroup(){var e=jQuery("#recipe-ingredients tr.ingredient-group-stub"),n=jQuery("#recipe-ingredients tr:last");e.clone(!0).insertAfter(n).removeClass("ingredient-group-stub").addClass("ingredient-group"),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show(),calculateIngredientGroups()}function calculateIngredientGroups(){1==jQuery(".ingredient-group").length?(jQuery("#recipe-ingredients .ingredient .ingredients_group").val(""),jQuery(".ingredient-groups-disabled").show(),jQuery(".ingredient-groups-enabled").hide()):(jQuery("#recipe-ingredients tr.ingredient").each(function(e,n){var t=jQuery(n).prevAll(".ingredient-group:first").find(".ingredient-group-label").val();void 0===t&&(t=jQuery(".ingredient-group-first").find(".ingredient-group-label").val()),jQuery(n).find(".ingredients_group").val(t)}),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show())}function addRecipeInstructionGroup(){var e=jQuery("#recipe-instructions tr.instruction-group-stub"),n=jQuery("#recipe-instructions tr:last");e.clone(!0).insertAfter(n).removeClass("instruction-group-stub").addClass("instruction-group"),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show(),calculateInstructionGroups()}function calculateInstructionGroups(){1==jQuery(".instruction-group").length?(jQuery("#recipe-instructions .instruction .instructions_group").val(""),jQuery(".instruction-groups-disabled").show(),jQuery(".instruction-groups-enabled").hide()):(jQuery("#recipe-instructions tr.instruction").each(function(e,n){var t=jQuery(n).prevAll(".instruction-group:first").find(".instruction-group-label").val();void 0===t&&(t=jQuery(".instruction-group-first").find(".instruction-group-label").val()),jQuery(n).find(".instructions_group").val(t)}),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show())}function updateIngredientIndex(){jQuery("#recipe-ingredients tr.ingredient").each(function(e){jQuery(this).find("input, textarea").attr("name",function(n,t){return t.replace(/(\d+)/,e)}).attr("id",function(n,t){return t.replace(/(\d+)/,e)})})}function addRecipeIngredient(e){var n=jQuery("#recipe-ingredients tr.ingredient").length,t=jQuery("#recipe-ingredients tr:last");e&&(t=e);var r=t.clone(!0);r.find("td.ingredient-preview").html(""),r.insertAfter(t).find("input, select, textarea").val("").attr("name",function(e,t){return t.replace(/(\d+)/,n)}).attr("id",function(e,t){return t.replace(/(\d+)/,n)}).closest("tr.ingredient").attr("id",function(e,t){return t.replace(/(\d+)/,n)}),r.find("span.ingredients-delete").show(),jQuery("#recipe-ingredients tr:last .ingredients_amount").focus(),calculateIngredientGroups()}function addRecipeInstruction(){var e=jQuery("#recipe-instructions tr.instruction").length,n=jQuery("#recipe-instructions tr.instruction:last").clone(!0);n.insertAfter("#recipe-instructions tr:last").find("textarea").val("").attr("name",function(n,t){return t.replace(/(\d+)/,e)}).attr("id",function(n,t){return t.replace(/(\d+)/,e)}),n.find(".recipe_instructions_remove_image").addClass("wpurp-hide"),n.find(".recipe_instructions_add_image").removeClass("wpurp-hide"),n.find(".recipe_instructions_thumbnail").val(""),n.find(".recipe_instructions_image").attr("name",function(n,t){return t.replace(/(\d+)/,e)}).attr("id",function(n,t){return t.replace(/(\d+)/,e)}).val(null),n.find(".recipe_instructions_thumbnail").attr("id",function(n,t){return t.replace(/(\d+)/,e)}).attr("src",custom_user_submissions.placeholder),n.find(".instructions_group").attr("name",function(n,t){return t.replace(/(\d+)/,e)}).attr("id",function(n,t){return t.replace(/(\d+)/,e)}),n.find("span.instructions-delete").show(),jQuery("#recipe-instructions tr:last textarea").focus(),calculateInstructionGroups()}function updateInstructionIndex(){jQuery("#recipe-instructions tr.instruction").each(function(e){jQuery(this).find("textarea").attr("name",function(n,t){return t.replace(/(\d+)/,e)}).attr("id",function(n,t){return t.replace(/(\d+)/,e)}),jQuery(this).find(".recipe_instructions_image").attr("name",function(n,t){return t.replace(/(\d+)/,e)}),jQuery(this).find(".instructions_group").attr("name",function(n,t){return t.replace(/(\d+)/,e)}).attr("id",function(n,t){return t.replace(/(\d+)/,e)})})}jQuery(document).ready(function(){jQuery("#insert-recipe-shortcode").on("click",function(){r("[recipe]")}),jQuery("#insert-nutrition-shortcode").on("click",function(){r("[nutrition-label]")});var e,n,t=jQuery("textarea#content");function r(e){if(!tinyMCE.activeEditor||tinyMCE.activeEditor.isHidden()){var n=t.val();t.val(n+e)}else tinyMCE.execCommand("mceInsertContent",!1,e)}calculateIngredientGroups(),jQuery("#ingredients-add-group").on("click",function(e){e.preventDefault(),addRecipeIngredientGroup()}),jQuery(".ingredient-group-label").on("input",function(){window.clearTimeout(e),e=window.setTimeout(function(){calculateIngredientGroups()},500)}),jQuery(".ingredient-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),calculateIngredientGroups()}),calculateInstructionGroups(),jQuery("#instructions-add-group").on("click",function(e){e.preventDefault(),addRecipeInstructionGroup()}),jQuery(".instruction-group-label").on("input",function(){window.clearTimeout(n),n=window.setTimeout(function(){calculateInstructionGroups()},500)}),jQuery("#recipe-ingredients tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){calculateIngredientGroups(),updateIngredientIndex()}}),jQuery(".ingredients-delete").on("click",function(){jQuery(this).parents("tr").remove(),updateIngredientIndex()}),jQuery("#ingredients-add").on("click",function(e){e.preventDefault(),addRecipeIngredient()}),jQuery("#recipe-ingredients").on("keydown",".ingredients_notes, .ingredient-group-label",function(e){if(console.log("%c Found keypress on "+jQuery(this).attr("class")+jQuery(this).attr("id"),"background:#CCC;color:blue"),9==(e.keyCode||e.which)&&0==e.shiftKey){var n=jQuery(this).closest("tr");console.log("currentRow = "+n.prop("tagName")+n.attr("class")),e.preventDefault(),isLastIngredient(n)?addRecipeIngredient(n):(console.log("ingredient.next.focus"),n.next().focus())}}),jQuery("#recipe-ingredients .ingredients_amount").on("keydown",function(e){var n=e.keyCode||e.which,t=(jQuery("#recipe-ingredients tr:last").attr("id"),jQuery(this).closest("tr.ingredient")),r=t.attr("id");if(console.log("Current ingredient : "+r),9==n&&1==e.shiftKey){event.preventDefault();var i=t.prev();i.focus();i.attr("id")}}),jQuery("#recipe-instructions tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){calculateInstructionGroups(),updateInstructionIndex()}}),jQuery(".instructions-delete").on("click",function(){jQuery(this).parents("tr").remove(),updateInstructionIndex()}),jQuery("#instructions-add").on("click",function(e){e.preventDefault(),addRecipeInstruction()}),jQuery("#recipe-instructions .instruction:last-of-type .instruction-text").on("keydown",function(e){9==(e.keyCode||e.which)&&0==e.shiftKey&&(e.preventDefault(),addRecipeInstruction())}),jQuery(".recipe-image-container").on("change","input.recipe_thumbnail_image",function(){PreviewImage("")}),jQuery(".recipe-instructions-container").on("change","input.recipe_instructions_image",function(){PreviewImage(jQuery(this).attr("id").match(/\d+/))}),jQuery("#wpurp-insert-recipe").on("click",function(){var e="[ultimate-recipe id=";e+=jQuery("#wpurp-recipe").find("option:selected").val(),e+="]",tinyMCE.activeEditor.execCommand("mceInsertContent",0,e),tinyMCE.activeEditor.windowManager.close()}),jQuery(".wpurp-file-remove").on("click",function(e){e.preventDefault();var n=jQuery(this);preview=n.siblings("img"),fieldname=preview.attr("class"),n.siblings("."+fieldname+"_image").val(""),n.siblings("."+fieldname).attr("src",""),n.siblings(".wpurp-file-upload").removeClass("wpurp-hide"),n.addClass("wpurp-hide")})}),jQuery(".instruction-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),calculateInstructionGroups()});