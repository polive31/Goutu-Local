
class JS_CSS_Optimize {
	
	function _construct() {
		add_action( 'wp_enqueue_scripts', 'save_enqueued_scripts', 100 );
		add_action( 'wp_enqueue_scripts', 'conditionally_deregister_scripts', PHP_INT_MAX );
		add_action( 'admin_menu', 'add_js_css_menu_option');
	}

	public function add_js_css_menu_option() {
		add_submenu_page(
	        'tools.php',
	        'JS & CSS Optimization',
	        'JS & CSS Optimization',
	        'manage_options',
	        'js_css_optimization',
	        'js_css_optimize_page'
	    );
	}

	public function js_css_optimize_page() {
	    // check user capabilities
	    if (!current_user_can('manage_options')) {
	        return;
	    }
	    ?>
	    <div class="wrap">
	        <h1><?= esc_html(get_admin_page_title()); ?></h1>
	        <div class="body">
	        	<?php list_enqueued_scripts();?> 
	        </div>
	        <!-- <form action="options.php" method="post">
	            // output security fields for the registered setting "wporg_options"
	            settings_fields('wporg_options');
	            // output setting sections and their fields
	            // (sections are registered for "wporg", each field is registered to a specific section)
	            do_settings_sections('wporg');
	            // output save settings button
	            submit_button('Save Settings');
	            ?>
	        </form>-->
	    </div>
	    <?php
	}


	public function list_enqueued_scripts() {
		
		echo '<h3> In List enqueued scripts function ! </h3>';

		global $WP_SCRIPTS;
		foreach( $WP_SCRIPTS->queue as $handle ) {
	     $obj = $WP_SCRIPTS->registered [$handle];
	     $filename = $obj->src;
	     echo '<p>' . $handle . ' : ' . $filename . '</p>';
		}

	}


	public function conditionally_deregister_scripts() {
		
		if ( !is_front_page() ) {
			wp_dequeue_script( 'easingslider' );
		}
		
		if ( !is_single() ) {
			//PC::debug(array('Not in POST OR RECIPE'));
			wp_dequeue_script( 'galleria' );
			wp_dequeue_script( 'galleria-fs' );
			wp_dequeue_script( 'galleria-fs-theme' );
		}
		
		wp_dequeue_script( 'cnss_js' );
		//wp_enqueue_script( 'cnss_js', PLUGINS_URL . '/easy-social-icons/js/cnss.js' , true );


		//wp_dequeue_script( 'jquery-ui-sortable' );
		//wp_dequeue_script( 'bp-confirm' );
		wp_deregister_script( 'bp-legacy-js' );
		wp_register_script( 'bp-legacy-js', 
			PLUGINS_URL . '/buddypress/bp-templates/bp-legacy/js/buddypress.min.js',
			array(),
			false,
			true );
		wp_enqueue_script( 'bp-legacy-js' );
	}


}

