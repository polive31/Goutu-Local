var formSubmitting=!1;function PreviewImage(id){console.log("Entering PreviewImage");var fileInput=document.getElementById("post_thumbnail_input_"+id);if(fileInput.files&&fileInput.files[0]){var extension=fileInput.files[0].name.split(".").pop().toLowerCase(),isSuccess;if(custom_post_submission_form.fileTypes.indexOf(extension)>-1){var imgSize=fileInput.files[0].size/1024;if(console.log("File size (kB) = "+fileInput.files[0].size/1024),imgSize<custom_post_submission_form.maxFileSize){var oFReader=new FileReader;oFReader.readAsDataURL(fileInput.files[0]),oFReader.onload=function(oFREvent){document.getElementById("post_thumbnail_preview_"+id).src=oFREvent.target.result,jQuery("#post_thumbnail_preview_"+id).parent(".thumbnail").removeClass("nodisplay")}}else jQuery(fileInput).val(""),alert(custom_post_submission_form.fileTooBig)}else jQuery(fileInput).val(""),alert(custom_post_submission_form.wrongFileType)}}function addButtonToEditor(text){if(!tinyMCE.activeEditor||tinyMCE.activeEditor.isHidden()){var text_editor=jQuery("#post_content"),current=text_editor.val();text_editor.val(current+text)}else tinyMCE.execCommand("mceInsertContent",!1,text)}jQuery(window).bind("beforeunload",function(e){if(console.log("before unload listener setup"),!formSubmitting)return!0;console.log("Detected form submission, so no warning")}),jQuery(document).ready(function(){jQuery("#new_post").submit(function(){console.log("Form submission, set formSubmitting to true"),formSubmitting=!0}),postId=jQuery('#new_post input[name="post_id"]'),tinymce.init({selector:"#post_content",theme:"modern",language:"fr_FR",statusbar:!1,menubar:!1,toolbar:"undo redo | styleselect | bold italic underline | link image | alignleft aligncenter alignright | bullist | searchreplace",plugins:"autoresize link spellchecker searchreplace placeholder lists image",autoresize_bottom_margin:20,placeholder_attrs:{style:{position:"absolute",top:"5px",left:0,color:"#888","font-style":"italic",padding:"1%",width:"98%",overflow:"hidden","white-space":"pre-wrap"}},images_upload_handler:function(blobInfo,success,failure){var formData=new FormData;formData.append("action","cpm_tinymce_upload_image"),formData.append("security",custom_post_submission_form.nonce),formData.append("postid",postId.val()),formData.append("file",blobInfo.blob(),blobInfo.filename()),jQuery.ajax({url:custom_post_submission_form.ajaxurl,xhrFields:{withCredentials:!1},type:"POST",data:formData,async:!0,cache:!1,processData:!1,contentType:!1,dataType:"json",success:function(json,textStatus,jqXHR){console.log("Image Upload Success !!! "),console.log("Location is : ",json.location),success(json.location)}})}}),jQuery("#custom_post_submission_form").on("change","input.post_thumbnail_image",function(){console.log("Change on featured image input detected"),PreviewImage("")}),jQuery("#custom_post_submission_form").on("click",".post_remove_image_button",function(){if(console.log("Click on remove image"),confirm(custom_post_submission_form.deleteImage)){var Id=jQuery(this).attr("id").match(/\d+/);Id=null!==Id?Id:"",thisPreview=jQuery("#post_thumbnail_preview_"+Id),thisInput=jQuery("#post_thumbnail_input_"+Id),postId=jQuery('#new_post input[name="post_id"]'),console.log("thisPreview = ",thisPreview),console.log("thisInput = ",thisInput);var data={action:"cpm_remove_featured_image",security:custom_post_submission_form.nonce,postid:postId.val(),thumbid:Id};jQuery.post(custom_post_submission_form.ajaxurl,data,function(response){console.log("Ajax call suceeded image removed !",response),thisPreview.removeAttr("src"),thisPreview.parents(".thumbnail").addClass("nodisplay"),thisInput.val("")})}})});